#include<stdio.h>
#include<string.h>
void create_account();
void deposit_money();
void withdraw_money();
void check_balance();

typedef struct Bank{
    long int acc_no;
    char name[100];
    float balance;

}Bank;

int main(){
    int choice;
    while(1){
    printf("\n***Bank Management System***");
    printf("\n1. Create Account ");
    printf("\n2. Deposit Money");
    printf("\n3. Withdraw Money");
    printf("\n4. Check Balance");
    printf("\n5. Exit");
    printf("\nNow,Choose the following menu: ");
    scanf("%d", &choice);

    switch (choice)
    {
    case 1://create account 
        create_account();
        break;
    case 2://deposit money
        deposit_money();
        break;
    case 3://withdraw monwy
        withdraw_money();
        break;
    case 4://check balance
        check_balance();
        break;
    case 5://exit
        printf("\nClosing the Bank, Thank you for visiting.");
        return 0;
        break;
    default:
        printf("\nInvalid choice, try again.");
        break;
    }

    }

 return 0;
}

void create_account(){
    Bank acc;
    FILE *file;
    file = fopen("Account.dat", "ab+");
    if(file==NULL){
        printf("\nUnable to find file.");
        return;
    }
    
    printf("\nEnter your name: ");
    getchar();
    fgets(acc.name, sizeof(acc.name),stdin);
    size_t len = strlen(acc.name);

    if(len >0 &&  acc.name[len - 1]=='\n'){
        acc.name[len-1]='\0';
    }
    printf("Enter your account number: ");
    scanf("%ld", &acc.acc_no);
    acc.balance=0;
   printf("intitial balance in your account is %.2f", acc.balance);

    fwrite(&acc,sizeof(acc), 1,file);
    printf("\nAccount created Successfully!!");

    fclose(file);

    
}
void deposit_money(){
   long int acc_n;
   float money;
   Bank acc_d;
   FILE *file;
   file = fopen("Account.dat", "rb+");
   if(file==NULL){
    printf("unable to open file!");
    return ;
   }
   printf("\nEnter your account number: ");
   scanf("%ld", &acc_n);
   printf("\nEnter amount you wish to deposit: ");
   scanf("%f", &money);

   while(fread(&acc_d,sizeof(acc_d), 1,file )){
    if(acc_n==acc_d.acc_no){
        acc_d.balance += money;
         fseek(file,-sizeof(acc_d),SEEK_CUR);
         fwrite(&acc_d,sizeof(acc_d),1,file);
         fclose(file);
         printf("Successfully deposited amount Rs.%.2f the current balance is %.2f", money,acc_d.balance);
         return ;
    }
   }
   fclose(file);
   printf("Money could not be deposited as the account no %d was not found in record.", acc_n);
}
void withdraw_money(){
    long int acc_no;
    float money;
    Bank acc_wi;
    FILE *file;
    file = fopen("Account.dat", "rb+");
    if(file==NULL){
        printf("\nunable to open file!!");
        return;
    }
    printf("\nEnter your account number: ");
    scanf("%ld", &acc_no);
    printf("Enter your amount you wish to withdraw: ");
    scanf("%f", &money);
    while (fread(&acc_wi,sizeof(acc_wi), 1, file))
    {
        if(acc_no==acc_wi.acc_no){
            if(acc_wi.balance>= money){
                acc_wi.balance -= money;
                fseek(file,-sizeof(acc_wi),SEEK_CUR);
                fwrite(&acc_wi,sizeof(acc_wi), 1, file);
                printf("Successfully withdraaw amount RS.%.2f the remaining balance is %.2f", money,acc_wi.balance);

            }
            else{
                printf("\nInsufficient balance");
            }

            fclose(file);
            return;
        }
    }
    printf("Money could not be withdraw as the account no %ld was not found in record.", acc_no);
    
    

}
void check_balance(){
    long int acc_no;
    Bank acc_r;

    FILE *file;
    file = fopen("Account.dat","rb+");
    if(file==NULL){
        printf("\nunable to open your file!!");
        return;
    }
    printf("\nEnter your account number: ");
    scanf("%ld", &acc_no);
    while(fread(&acc_r, sizeof(acc_r),1,file)){
      if(acc_no==acc_r.acc_no){
        printf("\nYour current balance is %.2f",acc_r.balance);
        fclose(file);
        return;
        }
    
    }
     fclose(file);
     printf("\nunable to find your file!!");
}